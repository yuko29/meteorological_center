<!DOCTYPE html>
<html lang="en">

<head>
    <!--
      Site created by Brian Design on youtube @ www.youtube.com/channel/UCsKsymTY_4BYR-wytLjex7A?view_as=subscriber
    -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSMC Meteorological Center</title>
    <link rel="stylesheet" href="static/main.css" />
    <link rel="stylesheet" href="static/navbar.css" />
    <link rel="stylesheet" href="static/reservoir.css" />
    <link rel="stylesheet" href="static/footer.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
        integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;700&display=swap" rel="stylesheet" />
</head>


<body>
    <!-- Navbar Section -->
    <nav class="navbar">
        <div class="navbar__container">
            <a href="/" id="navbar__logo"><img class="logo" src="static/Tsmc.svg.png"></i> Meteorological Center</a>
            <div class="navbar__toggle" id="mobile-menu">
                <span class="bar"></span> <span class="bar"></span>
                <span class="bar"></span>
            </div>
            <ul class="navbar__menu">
                <li class="navbar__item">
                    <a href="" class="navbar__links" id="hsinchu">Hsinchu</a>
                </li>
                <li class="navbar__item">
                    <a href="" class="navbar__links" id="taichung">Taichung</a>
                </li>
                <li class="navbar__item">
                    <a href="" class="navbar__links" id="tainan">Tainan</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Electricity and Earthquake Section-->
    <div class="main">
        <div class="main__container">
            <div class="main__content">
                <h1>
                    <!-- Show warning icons if warn_electricity is true -->
                    {% if warn_electricity %}   
                    <img class="warning" src="static/Ambox_warning_yellow.svg.png" width="70px" style="background-color: transparent; padding-right:10px">
                    {% endif %}
                    電力
                </h1>
                <h3>即時發電量</h3>
                <p id="electricity_value">-</p>
                <h3>當日最大發電容量</h3>
                <p id="electricity_maximum">-</p>
            </div>
            <div class="main__content">
                <h1>
                    {% if warn_earthquake %}
                    <img class="warning" src="static/Ambox_warning_yellow.svg.png" width="70px" style="background-color: transparent; padding-right:10px">
                    {% endif %}
                    地震
                </h1>
                <h3>最近發生時間</h3>
                <p id="earthquake_time">1990/01/01 AM 00:00</p>
                <h3>震度</h3>
                <p id="earthquake_magnitude">-</p>
                <h3></h3>
            </div>
        </div>

        <!-- Reservoir Section -->
        <div class="reservoir__container">
            <h1>水情資訊</h1>
            <div class="grid__container">
                <div class="reservoir__content">
                    <h3 id="reservoir_name_1">一號水庫</h3>
                    <p id="reservoir_percentage_1">- %</p>
                    <h3 id="reservoir_time_1">最後更新時間: 1990/01/01 AM 00:00</h3>
                </div>
                <div class="reservoir__content">
                    <h3 id="reservoir_name_2">二號水庫</h3>
                    <p id="reservoir_percentage_2">- %</p>
                    <h3 id="reservoir_time_2">最後更新時間: 1990/01/01 AM 00:00</h3>
                </div>
                <div class="reservoir__content">
                    <h3 id="reservoir_name_3">永和山水庫</h3>
                    <p id="reservoir_percentage_3">- %</p>
                    <h3 id="reservoir_time_3">最後更新時間: 1990/01/01 AM 00:00</h3>
                </div>
            </div>  
        </div>
    
        <!-- Footer Section -->
        <div class="footer__container">
                <p class="website__rights">© 2023 Cloud Native. All rights reserved</p>
        </div>
    </div>

    <script>
        // RWD Design
        const menu = document.querySelector('#mobile-menu');
        const menuLinks = document.querySelector('.navbar__menu');

        menu.addEventListener('click', function() {
            // 使用 AJAX 請求發送菜單狀態
            const xhr = new XMLHttpRequest();
            const menuState = menu.classList.contains('is-active') ? 'active' : 'inactive';
            const menuLinksState = menuLinks.classList.contains('active') ? 'active' : 'inactive';
            const url = '/toggle_menu?menu_state=' + menuState + '&menu_links_state=' + menuLinksState;

            xhr.open('GET', url, true);
            xhr.send();
        });

        // 獲取連結
        const hsinchuLink = document.querySelector('#hsinchu');
        const taichungLink = document.querySelector('#taichung');
        const tainanLink = document.querySelector('#tainan');
        
        // 定義共用的點擊事件處理函數
        function handle_click(event, url) {
            event.preventDefault(); // 阻止超連結的默認行為
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.send();

            // 接收響應並更新頁面數據
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                    // 接收頁面數據
                    const response = JSON.parse(xhr.responseText);
                    // 更新頁面數據
                    update_data(response.data)
                }
            };
        }

        // 添加點擊事件監聽器
        hsinchuLink.addEventListener('click', function(event) {handle_click(event, '/hsinchu');});
        taichungLink.addEventListener('click', function(event) {handle_click(event, '/taichung');});
        tainanLink.addEventListener('click', function(event) {handle_click(event, '/tainan');});

        function update_data(data) {
            // 獲取需要更新的元素
            const electricityValueElement = document.getElementById('electricity_value');
            const electricityMaximumElement = document.getElementById('electricity_maximum');

            const earthquakeTimeElement = document.getElementById('earthquake_time');
            const earthquakeMagnitudeElement = document.getElementById('earthquake_magnitude');

            const reservoirName1Element = document.getElementById('reservoir_name_1');
            const reservoirPercentage1Element = document.getElementById('reservoir_percentage_1');
            const reservoirTime1Element = document.getElementById('reservoir_time_1');

            const reservoirName2Element = document.getElementById('reservoir_name_2');
            const reservoirPercentage2Element = document.getElementById('reservoir_percentage_2');
            const reservoirTime2Element = document.getElementById('reservoir_time_2');

            const reservoirName3Element = document.getElementById('reservoir_name_3');
            const reservoirPercentage3Element = document.getElementById('reservoir_percentage_3');
            const reservoirTime3Element = document.getElementById('reservoir_time_3');

            // 更新元素的內容為最新的數據
            electricityValueElement.textContent = data.electricity_value;
            electricityMaximumElement.textContent = data.electricity_maximum;
            earthquakeTimeElement.textContent = data.earthquake_time;
            earthquakeMagnitudeElement.textContent = data.earthquake_magnitude;
            reservoirName1Element.textContent = data.reservoir_name_1;
            reservoirPercentage1Element.textContent = data.reservoir_percentage_1;
            reservoirTime1Element.textContent = data.reservoir_time_1;
            reservoirName2Element.textContent = data.reservoir_name_2;
            reservoirPercentage2Element.textContent = data.reservoir_percentage_2;
            reservoirTime2Element.textContent = data.reservoir_time_2;
            reservoirName3Element.textContent = data.reservoir_name_3;
            reservoirPercentage3Element.textContent = data.reservoir_percentage_3;
            reservoirTime3Element.textContent = data.reservoir_time_3;
        }
        
    </script>
</body>